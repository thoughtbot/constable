<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />
    <title>Constable daily digest</title>
    <%= raw render("styles.html") %>
    <style>
      .avatar-rounded {
        height: 20px;
        width: 20px;
        border-radius: 50%;
        margin-right: 0.3rem;
      }

      .left-padded {
        padding-left: 8px;
      }

      a {
        text-decoration: none; !important;
      }

      .discussion-summary {
        font-style: italic;
      }

      .content-body {
        padding-left: 1.85rem;
      }

      hr {
        border: 0;
        border-bottom: 1px solid #ccc;
        background: #999;
        margin-top: 2.0rem;
      }
    </style>
  </head>

  <body leftmargin="0" marginwidth="0" marginheight="0" offset="0" topmargin="0" style="padding: 0;">
    <table bgcolor="#fefefe" border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr>
        <td>
          <center>
          <!-- ===================================== -->
          <!-- Announcement Include -->
          <!-- ===================================== -->
          <!-- ===================================== -->
          <!-- Announcement Container -->
          <!-- ===================================== -->
          <!-- ===================================== -->
          <!-- Content Name -->
          <!-- ===================================== -->
          <table border='0' cellpadding='0' cellspacing='0' class='flex-size' style='color: #666A80; font-family: Helvetica, Tahoma, sans-serif; font-size: 16px; line-height: 1.5;' width='700'>
            <!-- Spacer -->
            <tr>
              <td colspan='3' height='35'></td>
            </tr>
            <!-- ===================================== -->
            <!-- Content -->
            <!-- ===================================== -->
            <!-- Spacer -->
            <tr>
              <td colspan='3' height='10'></td>
            </tr>
            <tr>
              <td width='40'></td>
              <td align='left'>
                <h2>Summary</h2>

                <%= unless Enum.empty?(@interests) do %>
                  <h3>Recently added interests</h3>
                  <ul>
                    <%= for interest <- @interests do %>
                      <li>
                        <%= link "##{interest.name}", to: interest_url(ConstableWeb.Endpoint, :show, interest), style: "color: #{red()}" %>
                      </li>
                    <% end %>
                  </ul>
                <% end %>

                <%= unless Enum.empty?(@announcements) do %>
                  <h3>Recently posted announcements</h3>
                  <ul>
                    <%= for announcement <- @announcements do %>
                      <li>
                        <%= link announcement.title, to: announcement_url(ConstableWeb.Endpoint, :show, announcement), style: "color: #{red()}" %>
                        <%= gettext("posted by") %> <strong><%= announcement.user.name %></strong> <%= gettext("in") %> <%= raw interest_links(announcement) %>
                      </li>
                    <% end %>
                  </ul>
                <% end %>

                <%= unless Enum.empty?(@announcements) do %>
                  <hr />
                  <h3><%= gettext("Announcements") %></h3>

                  <%= for announcement <- @announcements do %>
                    <div class="left-padded">
                      <h4><%= link announcement.title, to: announcement_url(ConstableWeb.Endpoint, :show, announcement), style: "color: #{red()}" %></h4>
                      <p>
                        <img src="<%= author_avatar_url(announcement.user) %>" class="avatar-rounded">
                        <strong><%= announcement.user.name %></strong>
                        <%= gettext("posted to") %> <%= raw interest_links(announcement) %>
                        <%= time_ago_in_words announcement.inserted_at %>:
                      </p>
                      <div class="content-body">
                        <%= raw markdown_with_users(announcement.body) %>
                      </div>
                    </div>
                  <% end %>
                <% end %>

                <%= unless Enum.empty?(@comments) do %>
                  <hr />
                  <h3><%= gettext("Discussions") %></h3>
                  <p class="discussion-summary">
                    &rarr; There
                    <%= ngettext("was %{count} announcement", "were %{count} announcements", length(discussed_announcements(@comments))) %>
                    discussed by
                    <%= ngettext("%{count} person", "%{count} people", length(unique_commenters(@comments))) %>&hellip;
                  </p>

                  <%= for announcement <- discussed_announcements(@comments) do %>
                    <div class="left-padded">
                      <h4><%= link announcement.title, to: announcement_url(ConstableWeb.Endpoint, :show, announcement), style: "color: #{red()}" %></h4>
                      <%= new_comment_count_text(@comments, announcement) %> <%= commenters_list_text(announcement, @comments) %>
                      <%= for comment <- new_comments(@comments, announcement) do %>
                        <p>
                          <img src="<%= author_avatar_url(comment.user) %>" class="avatar-rounded">
                          <strong><%= comment.user.name %></strong> left a comment <%= time_ago_in_words comment.inserted_at %>:
                        </p>
                        <div class="content-body">
                          <%= raw markdown_with_users(comment.body) %>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
              </td>
              <td width='40'></td>
            </tr>
            <!-- ===================================== -->
            <!-- Closing -->
            <!-- ===================================== -->
            <!-- Spacer -->
            <tr>
              <td colspan='3' height='45'></td>
            </tr>
            <tr>
              <td width='40'></td>
              <td align='center'>
                <hr />
                <%= link to: announcement_url(ConstableWeb.Endpoint, :index) do %>
                  <h4 style='color: <%= red() %>; font-size: 18px; margin: 0; padding-bottom: 5px;'>
                    <%= gettext("View Interests and Announcements on Constable") %>
                  </h4>
                <% end %>
              </td>
              <td width='40'></td>
            </tr>
            <!-- Spacer -->
            <tr>
              <td colspan='3' height='45'></td>
            </tr>
          </table>
          <!-- ===================================== -->
          <!-- Footer Include -->
          <!-- ===================================== -->
          <!-- ===================================== -->
          <!-- Footer Container -->
          <!-- ===================================== -->
          <table bgcolor='#ffffff' border='0' cellpadding='0' cellspacing='0' width='100%'>
            <tr>
              <td>
                <!-- ===================================== -->
                <!-- Footer Content -->
                <!-- ===================================== -->
                <table align='center' border='0' cellpadding='0' cellspacing='0' class='flex-size' style='color: #d4d4d4; font-family: Helvetica, Tahoma, sans-serif; font-size: 16px; line-height: 1.5; font-size: 14px;' width='700'>
                  <!-- Vertical Spacer -->
                  <tr>
                    <td colspan='3' height='30'></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
          </center>
        </td>
      </tr>
    </table>
  </body>
</html>
