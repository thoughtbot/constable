#!/usr/bin/env sh

# Exit if any subcommand fails
set -e

# set up environment variables
cp .sample.env .env

# Set up phoenix
mix local.hex --force
mix deps.get
mix deps.compile
mix compile

# Set up database
mix ecto.create
mix ecto.migrate

# If not CI and heroku executable is present
if [ -z "$CI" ]; then
  if ! type "heroku" > /dev/null; then
    heroku join --app constable-api-staging
    heroku git:remote -r staging -a constable-api-staging

    heroku join --app constable-api-production
    heroku git:remote -r production -a constable-api-production
  fi
fi
